<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SWA Windapp â€“ Schokkerhaven</title>
<script src="https://cdn.tailwindcss.com?plugins=typography"></script>
<style>
:root{
  --brand:#E71C1F;
  --brand-dark:#000000;
  --bg:#f4f4f4;
  --font:"Inter",system-ui,Helvetica,Arial,sans-serif;
}
body{font-family:var(--font);background:var(--bg);}
</style>
</head>
<body class="min-h-screen flex flex-col items-center p-4">

<header class="w-full max-w-md text-center mb-6">
  <img src="Logo.png" alt="SWA-logo" class="mx-auto mb-2" style="max-height:110px;width:auto;object-fit:contain">
  <h1 class="text-3xl font-bold tracking-tight" style="color:var(--brand)">SWA Windapp</h1>
  <p class="text-sm text-slate-600">Wind â€¢ Schokkerhaven â€“ live + 8 u forecast</p>
</header>

<section id="current" class="w-full max-w-md bg-white rounded-2xl shadow p-4 mb-4 flex flex-col items-center gap-1">
  <h2 class="font-semibold" style="color:var(--brand)">Huidig&nbsp;<span id="currTime" class="text-xs text-slate-500"></span></h2>
  <p id="currLine" class="text-2xl font-bold">â€“</p>
  <p id="currDir" class="uppercase tracking-widest text-sm text-slate-600">â€“</p>
</section>

<section class="w-full max-w-md">
  <div class="grid grid-cols-4 gap-2 text-center text-xs font-semibold text-white">
    <div class="py-1 rounded-t-lg" style="background:var(--brand-dark)">Tijd</div>
    <div class="py-1 rounded-t-lg" style="background:var(--brand-dark)">Weer</div>
    <div id="h2label" class="py-1 rounded-t-lg" style="background:var(--brand-dark)">ICON-D2</div>
    <div id="h3label" class="py-1 rounded-t-lg" style="background:var(--brand-dark)">HARM-NL</div>
  </div>
  <div id="forecastRows" class="grid grid-cols-4 gap-2 text-center bg-white rounded-b-2xl shadow"></div>
</section>

<p id="err" class="hidden mt-6 text-sm text-red-600 text-center max-w-md"></p>

<footer class="mt-6 text-[10px] text-slate-500">
  Weerdata: KNMI via <a href="https://weerlive.nl" class="underline">Weerlive</a> â€¢ Forecast via <a href="https://open-meteo.com" class="underline">Open-Meteo</a>
</footer>

<script>
(()=>{
/* ---------------- CONFIG ---------------- */
const WEERLIVE_KEY="320a946057";          // â† jouw key
const LIVE_LOC   ="Marknesse";

const lat=52.613, lon=5.747, tz="Europe/Amsterdam", hours=8;
const model1="icon_d2", model2="knmi_harmonie_arome_netherlands";
h2label.textContent="ICON-D2"; h3label.textContent="HARM-NL";

/* ---------------- HELPERS --------------- */
const showErr=m=>{ err.textContent=m; err.classList.remove("hidden"); };

const deg2card=d=>{
  const dirs=["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"];
  return dirs[Math.round(d/22.5)%16];
};
const hhmm=s=>s.slice(11,16);
const wmo=c=>[["â˜€ï¸"],["ðŸŒ¤ï¸"],["â›…"],["â˜ï¸"],[],[],[],[],[],[],[],[],[],[],[],[],[],[],["ðŸŒ«ï¸"],["ðŸŒ«ï¸"]][c]||(
  [51,53,55,56,57,61,63,65,66,67,80,81,82].includes(c)?"ðŸŒ§ï¸":
  [71,73,75,77,85,86].includes(c)?"â„ï¸":
  [95,96,99].includes(c)?"â›ˆï¸":"â“");

/* ---------------- MAIN FN --------------- */
async function init(){
  /* ---- 1. probeer Weerlive ---- */
  let liveOK=false;
  try{
    const wl=await fetch(`https://weerlive.nl/api/weerlive_api_v2.php?key=${WEERLIVE_KEY}&locatie=${encodeURIComponent(LIVE_LOC)}`).then(r=>r.json());
    const l=wl.liveweer?.[0];
    if(l){
      const v=Math.round(parseFloat(l.windknp));
      const g=parseFloat(l.windknpmax);
      const gust=Number.isNaN(g)?null:Math.round(g);
      currLine.innerHTML = gust!==null
        ? `${v} kn <span class="text-lg font-semibold" style="color:var(--brand)">(${gust} kn)</span>`
        : `${v} kn`;
      currDir.textContent=l.windr.toUpperCase();
      currTime.textContent=`(${l.time})`;
      liveOK=true;
    }
  }catch{ /* fall back below */ }

  /* ---- 2. fallback naar Open-Meteo current_weather ---- */
  if(!liveOK){
    console.info("fallback to Open-Meteo live");
    const om=await fetch(
      `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`+
      `&hourly=wind_gusts_10m&wind_speed_unit=kn&forecast_hours=1&timezone=${tz}`
    ).then(r=>r.json());
    const v = Math.round(om.current_weather.windspeed);
    const g = Math.round(om.hourly.wind_gusts_10m[0]);
    currLine.innerHTML=`${v} kn <span class="text-lg font-semibold" style="color:var(--brand)">(${g} kn)</span>`;
    currDir.textContent=deg2card(om.current_weather.winddirection);
    currTime.textContent=`(${hhmm(om.current_weather.time)})`;
  }

  /* ---- 3. forecast ---- */
  const [wx,f1,f2]=await Promise.all([
    fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=weathercode&forecast_hours=${hours}&timezone=${tz}`).then(r=>r.json()),
    fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=wind_speed_10m,wind_direction_10m,wind_gusts_10m&wind_speed_unit=kn&forecast_hours=${hours}&models=${model1}&timezone=${tz}`).then(r=>r.json()),
    fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=wind_speed_10m,wind_direction_10m,wind_gusts_10m&wind_speed_unit=kn&forecast_hours=${hours}&models=${model2}&timezone=${tz}`).then(r=>r.json())
  ]);

  const rows=document.getElementById("forecastRows");
  for(let i=0;i<hours;i++){
    rows.insertAdjacentHTML("beforeend",`
      <div class="py-1 border-b">${hhmm(f1.hourly.time[i])}</div>
      <div class="py-1 border-b">${wmo(wx.hourly.weathercode[i])}</div>
      ${[f1,f2].map(f=>{
        const v=Math.round(f.hourly.wind_speed_10m[i]);
        const g=Math.round(f.hourly.wind_gusts_10m[i]);
        const d=deg2card(f.hourly.wind_direction_10m[i]);
        return `<div class="py-1 border-b leading-tight">
                  <span class="font-medium">${v}</span>
                  <span class="text-[10px] ml-1 text-slate-500">${d}</span><br>
                  <span class="text-xs font-semibold" style="color:var(--brand)">${g}</span>
                </div>`;
      }).join("")}
    `);
  }
}

init().catch(e=>showErr(e.message));
})();
</script>
</body>
</html>
